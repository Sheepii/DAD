{% extends "admin/base_site.html" %}
{% load i18n %}

{% block content %}
  <div class="module">
    <h1>Mockup Studio</h1>
    <p class="help">Upload a design and generate mockups without creating a task.</p>
    <form method="post" enctype="multipart/form-data" style="display:grid;gap:12px;max-width:520px;">
      {% csrf_token %}
      <div class="form-row">
        <label>Task Template</label>
        <select name="template_id" required>
          <option value="">Select a template</option>
          {% for template in templates %}
            <option value="{{ template.id }}" {% if selected_template and template.id == selected_template.id %}selected{% endif %}>
              {{ template.name }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="form-row">
        <label>Store (optional bucket)</label>
        <select name="store_id">
          <option value="">All stores</option>
          {% for store in stores %}
            <option value="{{ store.id }}" {% if selected_store and store.id == selected_store.id %}selected{% endif %}>
              {{ store.name }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="form-row">
        <label>Date (folder)</label>
        <input type="date" name="due_date" value="{{ selected_date|date:'Y-m-d' }}" required />
      </div>
      <div class="form-row">
        <label>Upload design</label>
        <input type="file" name="design_upload" required />
      </div>
      <button class="button default" type="submit">Generate mockups</button>
    </form>
  </div>

  {% if results %}
    <div class="module">
      <h2>Generated Mockups</h2>
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;">
        {% for item in results %}
          <div style="border:1px solid #2c2c2c;border-radius:10px;padding:10px;background:#1c1c1c;">
            <img
              src="https://drive.google.com/thumbnail?id={{ item.file_id }}&sz=w300"
              alt="{{ item.label }}"
              style="width:100%;height:160px;object-fit:cover;border-radius:8px;background:#000;"
            />
            <div style="margin-top:8px;font-size:12px;color:#e2e2e2;">
              <div style="font-weight:600;">{{ item.label }}</div>
              <div style="opacity:0.7;">{{ item.filename }}</div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endblock %}
