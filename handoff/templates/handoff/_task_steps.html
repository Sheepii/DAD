<div class="mb-3">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h5 class="card-title mb-0">Checklist</h5>
    <div class="text-muted small">{{ task.progress_text }}</div>
  </div>
  <div class="progress" style="height: 14px;">
    <div
      class="progress-bar"
      role="progressbar"
      style="width: {% if task.total_steps %}{% widthratio task.done_steps task.total_steps 100 %}{% else %}0{% endif %}%"
      aria-valuenow="{{ task.done_steps }}"
      aria-valuemin="0"
      aria-valuemax="{{ task.total_steps }}"
    ></div>
  </div>
</div>

{% if task.steps.all %}
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div class="text-muted small">Next step is highlighted</div>
    <button class="btn btn-sm btn-outline-secondary" id="toggle-completed-steps" type="button">
      Hide completed
    </button>
  </div>
  <ul class="list-group list-group-flush checklist-lg" id="checklist-items">
    {% for step in task.steps.all %}
      <li class="list-group-item d-flex align-items-center justify-content-between gap-2{% if step.done %} is-done{% endif %}{% if first_incomplete_id == step.id %} is-next{% endif %}">
        <div class="form-check d-flex align-items-center gap-2 mb-0">
          <input
            class="form-check-input mt-0"
            type="checkbox"
            {% if step.done %}checked{% endif %}
            hx-post="{% url 'handoff:toggle_step' step.id %}"
            hx-target="#steps-panel"
            hx-swap="innerHTML"
          />
          <label class="form-check-label mb-0 {% if step.done %}text-decoration-line-through text-muted{% endif %}">
            {{ step.text }}
          </label>
        </div>
        {% if step.done %}
          <span class="badge text-bg-success">Done</span>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
{% else %}
  <div class="text-muted">No steps yet.</div>
{% endif %}
