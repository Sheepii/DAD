{% load handoff_extras %}
<div
  class="mockup-slot border rounded p-2 text-center position-relative{% if required_orders|get_item:slot.order %} mockup-required{% endif %}{% if slot.drive_file_id %} is-filled{% endif %}"
  data-slot-id="{{ slot.id }}"
>
  {% if slot.drive_file_id %}
    <a
      href="{% url 'handoff:mockup_file_download' slot.drive_file_id %}"
      download="{% if slot.filename %}{{ slot.filename }}{% else %}mockup-{{ slot.order }}.png{% endif %}"
      class="d-block text-decoration-none"
    >
      <img
        src="https://drive.google.com/thumbnail?id={{ slot.drive_file_id }}&sz=w300&t={{ slot.updated_at|date:'U' }}"
        alt="Mockup {{ slot.order }}"
        class="img-fluid rounded mb-2"
        style="background: #000; object-fit: cover; display: block;"
        loading="lazy"
      />
    </a>
  {% elif fallback_image_id %}
    <a
      href="{% url 'handoff:mockup_file_download' fallback_image_id %}"
      download="mockup-{{ slot.order }}.png"
      class="d-block text-decoration-none"
    >
      <img
        src="https://drive.google.com/thumbnail?id={{ fallback_image_id }}&sz=w300&t={{ slot.updated_at|date:'U' }}"
        alt="Mockup {{ slot.order }}"
        class="img-fluid rounded mb-2"
        style="background: #000; object-fit: cover; opacity: 0.85; display: block;"
        loading="lazy"
      />
    </a>
  {% else %}
    <div
      class="d-flex align-items-center justify-content-center rounded mb-2"
      style="width: 100%; aspect-ratio: 1 / 1; background: #000; color: #fff;"
    >
      No mockup
    </div>
  {% endif %}

  <div class="small fw-semibold">
    {% if slot.label %}
      {{ slot.label }}
    {% else %}
      Mockup {{ slot.order }}
    {% endif %}
    {% if required_orders|get_item:slot.order %}
      <span class="badge text-bg-warning ms-1">Required</span>
    {% endif %}
  </div>
  {% if slot.filename %}
    <div class="text-muted small">{{ slot.filename }}</div>
  {% endif %}
  {% if required_orders|get_item:slot.order and not slot.drive_file_id %}
    <div class="text-muted small">Needs replacement</div>
  {% endif %}
  {% if error %}
    <div class="text-danger small mt-1">{{ error }}</div>
  {% endif %}
</div>
