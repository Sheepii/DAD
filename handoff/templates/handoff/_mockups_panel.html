{% load handoff_extras %}
<div id="mockups-panel">
  <h5 class="card-title">Mockups</h5>
  <div class="text-muted small mb-2">
    Click a mockup image to download it.
  </div>
  <div class="mb-3">
    <a
      class="btn btn-primary btn-sm me-2"
      href="{% url 'handoff:download_mockups' task.id %}"
    >
      Download ZIP
    </a>
  </div>
  <div class="row g-2">
    {% for slot in task.mockup_slots.all %}
      <div class="col-6 col-md-4 col-lg-3">
        {% with fallback_image_id=slot_images|get_item:slot.order %}
          {% if slot.drive_file_id or fallback_image_id or required_orders|get_item:slot.order %}
            {% include "handoff/_mockup_slot.html" with slot=slot fallback_image_id=fallback_image_id required_orders=required_orders %}
          {% endif %}
        {% endwith %}
      </div>
    {% endfor %}
  </div>

  {% if zip_extras %}
    <hr class="my-3" />
    <h6 class="mb-2">Included In ZIP (not generated mockups)</h6>
    <div class="row g-2">
      {% for extra in zip_extras %}
        <div class="col-6 col-md-4 col-lg-3">
          <div class="border rounded p-2 h-100">
            {% if extra.is_video %}
              <video
                controls
                class="w-100 rounded mb-2"
                style="background: #000; aspect-ratio: 1/1; object-fit: cover;"
                preload="metadata"
              >
                <source src="{% url 'handoff:mockup_file_download' extra.drive_file_id %}" />
              </video>
            {% else %}
              <a
                href="{% url 'handoff:mockup_file_download' extra.drive_file_id %}"
                download="{{ extra.filename }}"
                class="d-block text-decoration-none"
              >
                <img
                  src="https://drive.google.com/thumbnail?id={{ extra.drive_file_id }}&sz=w300"
                  alt="{{ extra.label }}"
                  class="img-fluid rounded mb-2"
                  style="background: #000; object-fit: cover; display: block;"
                  loading="lazy"
                />
              </a>
            {% endif %}
            <div class="small fw-semibold">{{ extra.label }}</div>
            <div class="text-muted small">{{ extra.filename }}</div>
            {% if not extra.include_in_mockup_zip %}
              <div class="text-warning small">Visible only (not included in ZIP)</div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>
