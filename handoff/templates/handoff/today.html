{% extends "handoff/base.html" %}

{% block title %}Today - DAD{% endblock %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h3 mb-1">Today</h1>
      <div class="text-muted small">
        {{ today_date|date:"F j, Y" }} Â· {{ assignee }}
      </div>
    </div>
  </div>

  {% if tasks %}
    <div class="row g-3">
      {% for task in tasks %}
        <div class="col-12">
          <a
            class="card shadow-sm text-decoration-none text-reset"
            href="{% url 'handoff:task_detail' task.id %}{% if store %}?store={{ store.id }}{% endif %}"
          >
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center gap-3">
                <div class="d-flex align-items-center gap-3">
                  {% if task.drive_design_file_id %}
                    <div
                      class="rounded border d-flex align-items-center justify-content-center"
                      style="width: 68px; height: 68px; background: #000; overflow: hidden;"
                    >
                      <img
                        src="https://drive.google.com/thumbnail?id={{ task.drive_design_file_id }}&sz=w240&t={{ task.updated_at|date:'U' }}"
                        alt="Design thumbnail"
                        class="rounded"
                        style="width: 100%; height: 100%; object-fit: cover; background: #000; display: block;"
                        loading="lazy"
                      />
                    </div>
                  {% endif %}
                  <div>
                    <h5 class="card-title mb-1">{{ task.title }}</h5>
                    <div class="text-muted small">{{ task.progress_text }}</div>
                    <div class="text-muted small">
                      Status: {{ task.get_status_display }}
                    </div>
                    {% if task.display_store_name %}
                      <div class="text-muted small">
                        Store: {{ task.display_store_name }}
                      </div>
                    {% endif %}
                    <div class="progress mt-2" style="height: 8px; max-width: 240px;">
                      <div
                        class="progress-bar"
                        role="progressbar"
                        style="width: {% if task.total_steps %}{% widthratio task.done_steps task.total_steps 100 %}{% else %}0{% endif %}%"
                      ></div>
                    </div>
                  </div>
                </div>
                <span
                  class="badge {% if task.status == 'DONE' %}text-bg-success{% elif task.status == 'IN_PROGRESS' %}text-bg-warning{% else %}text-bg-secondary{% endif %}"
                >
                  {{ task.get_status_display }}
                </span>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-secondary">
      No tasks for {{ assignee }} today.
    </div>
  {% endif %}
{% endblock %}
